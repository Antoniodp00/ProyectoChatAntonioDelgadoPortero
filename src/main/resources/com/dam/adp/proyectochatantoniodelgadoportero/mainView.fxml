<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.*?>
<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.controlsfx.glyphfont.Glyph?>

<AnchorPane prefHeight="640.0" prefWidth="960.0" styleClass="main-container" xmlns="http://javafx.com/javafx/17.0.12" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.dam.adp.proyectochatantoniodelgadoportero.controller.MainController">
    <stylesheets>
        <String fx:value="@style.css" />
    </stylesheets>
    <children>
        <HBox spacing="15.0" AnchorPane.bottomAnchor="20.0" AnchorPane.leftAnchor="20.0" AnchorPane.rightAnchor="20.0" AnchorPane.topAnchor="20.0">
            <children>
                <VBox fx:id="menuLateral" prefWidth="200.0" spacing="10.0" styleClass="sidebar">
                    <children>
                        <Label styleClass="section-title" text="Usuarios" />
                        <ListView fx:id="listaUsuarios" styleClass="list-view" VBox.vgrow="ALWAYS" />
                        <Button fx:id="btnCerrarSesion" maxWidth="1.7976931348623157E308" onAction="#cerrarSesion" styleClass="danger-button" text="Cerrar sesión">
                            <graphic>
                                <Glyph fontFamily="FontAwesome" icon="SIGN_OUT" fontSize="16" />
                            </graphic>
                        </Button>
                    </children>
                </VBox>
                <VBox fx:id="panelChat" alignment="TOP_CENTER" prefWidth="580.0" spacing="12.0" styleClass="chat-panel" HBox.hgrow="ALWAYS">
                    <children>
                        <HBox alignment="CENTER_LEFT" spacing="10.0">
                            <children>
                                <Label fx:id="lblUsuarioChat" styleClass="chat-header-label" text="Selecciona un usuario para chatear" />
                                <Pane HBox.hgrow="ALWAYS" />
                                <Button fx:id="btnGenerarResumen" onAction="#generarResumen" styleClass="secondary-button" text="Generar resumen">
                                    <graphic>
                                        <Glyph fontFamily="FontAwesome" icon="LINE_CHART" fontSize="16" />
                                    </graphic>
                                    <tooltip>
                                        <Tooltip text="Generar estadísticas de la conversación (Streams)" />
                                    </tooltip>
                                </Button>
                            </children>
                        </HBox>
                        <TitledPane expanded="false" text="Resumen de la conversación (Streams)">
                            <content>
                                <GridPane hgap="10.0" vgap="6.0">
                                    <columnConstraints>
                                        <ColumnConstraints percentWidth="40.0" />
                                        <ColumnConstraints percentWidth="60.0" />
                                    </columnConstraints>
                                    <children>
                                        <Label text="Total mensajes:" />
                                        <Label fx:id="lblTotalMensajes" text="-" GridPane.columnIndex="1" />
                                        <Label text="Mensajes por usuario:" GridPane.rowIndex="1" />
                                        <Label fx:id="lblMensajesPorUsuario" text="-" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                                        <Label text="Palabras más comunes:" GridPane.rowIndex="2" />
                                        <Label fx:id="lblPalabrasComunes" text="-" GridPane.columnIndex="1" GridPane.rowIndex="2" />
                                    </children>
                                    <padding>
                                        <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                                    </padding>
                           <rowConstraints>
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                           </rowConstraints>
                                </GridPane>
                            </content>
                        </TitledPane>
                        <ListView fx:id="lvChat" styleClass="message-list" VBox.vgrow="ALWAYS" />
                        <VBox alignment="CENTER_LEFT" spacing="8.0">
                            <children>
                                <HBox alignment="CENTER_LEFT" spacing="10.0">
                                    <children>
                                        <TextField fx:id="txtMensaje" promptText="Escribe un mensaje..." styleClass="text-field" HBox.hgrow="ALWAYS" />
                                        <Button fx:id="btnAdjuntar" styleClass="secondary-button" text="Adjuntar">
                                            <graphic>
                                                <Glyph fontFamily="FontAwesome" icon="PAPERCLIP" fontSize="16" />
                                            </graphic>
                                            <tooltip>
                                                <Tooltip text="Añadir imagen/PDF u otros" />
                                            </tooltip>
                                        </Button>
                                        <Button fx:id="btnEnviar" onAction="#enviarMensaje" styleClass="primary-button" text="Enviar">
                                            <graphic>
                                                <Glyph fontFamily="FontAwesome" icon="SEND" fontSize="16" />
                                            </graphic>
                                        </Button>
                                    </children>
                                </HBox>
                                <HBox alignment="CENTER_LEFT" spacing="10.0">
                                    <children>
                                        <Label text="Adjuntos:" />
                                        <ListView fx:id="listaAdjuntos" prefHeight="70.0" prefWidth="350.0" styleClass="list-view" />
                                        <Button fx:id="btnAbrirAdjunto" styleClass="secondary-button" text="Abrir">
                                            <graphic>
                                                <Glyph fontFamily="FontAwesome" icon="FOLDER_OPEN" fontSize="16" />
                                            </graphic>
                                        </Button>
                                        <Button fx:id="btnExportarAdjunto" styleClass="secondary-button" text="Exportar">
                                            <graphic>
                                                <Glyph fontFamily="FontAwesome" icon="DOWNLOAD" fontSize="16" />
                                            </graphic>
                                        </Button>
                                    </children>
                                </HBox>
                            </children>
                        </VBox>
                        <Separator />
                        <HBox alignment="CENTER_RIGHT" spacing="10.0">
                            <children>
                                <CheckBox fx:id="chkSoloAdjuntos" text="Filtrar mensajes con adjuntos" />
                                <Pane HBox.hgrow="ALWAYS" />
                                <Button fx:id="btnExportarTxt" onAction="#exportarTxt" styleClass="secondary-button" text="Exportar TXT">
                                    <graphic>
                                        <Glyph fontFamily="FontAwesome" icon="FILE_TEXT_ALT" fontSize="16" />
                                    </graphic>
                                    <tooltip>
                                        <Tooltip text="Exportar conversación a texto plano" />
                                    </tooltip>
                                </Button>
                                <Button fx:id="btnExportarCsv" onAction="#exportarCsv" styleClass="secondary-button" text="Exportar CSV">
                                    <graphic>
                                        <Glyph fontFamily="FontAwesome" icon="FILE_CODE" fontSize="16" />
                                    </graphic>
                                    <tooltip>
                                        <Tooltip text="Exportar conversación a CSV" />
                                    </tooltip>
                                </Button>
                                <Button fx:id="btnExportarZip" styleClass="secondary-button" text="ZIP (conv+adj)">
                                    <graphic>
                                        <Glyph fontFamily="FontAwesome" icon="FILE_ARCHIVE_ALT" fontSize="16" />
                                    </graphic>
                                    <tooltip>
                                        <Tooltip text="Empaquetar conversación y adjuntos en ZIP" />
                                    </tooltip>
                                </Button>
                            </children>
                        </HBox>
                        <Label fx:id="lblEstado" styleClass="status-label" text="Listo" />
                    </children>
                </VBox>
            </children>
        </HBox>
    </children>
</AnchorPane>
